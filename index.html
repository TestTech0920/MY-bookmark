<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#f59e0b">
  <meta name="description" content="Mobile-first bookmark manager">
  <title>Mani's Bookmark Vault</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23f59e0b'/><path d='M30 20h40v65l-20-15-20 15z' fill='white'/></svg>">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --bg-start: #fffbeb;
      --bg-mid: #fef3c7;
      --bg-end: #dbeafe;
      --card-bg: rgba(255, 255, 255, 0.92);
      --input-bg: #ffffff;
      --sheet-bg: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-light: rgba(0, 0, 0, 0.08);
      --border-medium: rgba(0, 0, 0, 0.12);
      --accent: #f59e0b;
      --accent-light: rgba(245, 158, 11, 0.15);
      --danger: #ef4444;
      --success: #22c55e;
      --nav-bg: rgba(255, 255, 255, 0.95);
      --glow: none;
    }
    
    /* Dark Theme */
    body.dark {
      --bg-start: #0f172a;
      --bg-mid: #1e293b;
      --bg-end: #0f172a;
      --card-bg: rgba(30, 41, 59, 0.95);
      --input-bg: rgba(30, 41, 59, 0.95);
      --sheet-bg: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-light: rgba(255, 255, 255, 0.08);
      --border-medium: rgba(255, 255, 255, 0.12);
      --nav-bg: rgba(15, 23, 42, 0.95);
    }
    
    /* Neon Pink Theme */
    body.neon-pink {
      --bg-start: #0a0a0a;
      --bg-mid: #1a0a1a;
      --bg-end: #0a0a1a;
      --card-bg: rgba(20, 10, 30, 0.9);
      --input-bg: rgba(30, 15, 40, 0.95);
      --sheet-bg: #1a0a2a;
      --text-primary: #ff6ec7;
      --text-secondary: #c77dff;
      --text-muted: #9d4edd;
      --border-light: rgba(255, 110, 199, 0.2);
      --border-medium: rgba(255, 110, 199, 0.3);
      --accent: #ff6ec7;
      --accent-light: rgba(255, 110, 199, 0.2);
      --nav-bg: rgba(20, 10, 30, 0.95);
      --glow: 0 0 20px rgba(255, 110, 199, 0.3);
    }
    
    /* Neon Cyan Theme */
    body.neon-cyan {
      --bg-start: #0a0a0a;
      --bg-mid: #0a1a1a;
      --bg-end: #0a0a1a;
      --card-bg: rgba(10, 25, 35, 0.9);
      --input-bg: rgba(15, 35, 45, 0.95);
      --sheet-bg: #0a2a3a;
      --text-primary: #00ffff;
      --text-secondary: #00d4ff;
      --text-muted: #00a8cc;
      --border-light: rgba(0, 255, 255, 0.2);
      --border-medium: rgba(0, 255, 255, 0.3);
      --accent: #00ffff;
      --accent-light: rgba(0, 255, 255, 0.15);
      --nav-bg: rgba(10, 25, 35, 0.95);
      --glow: 0 0 20px rgba(0, 255, 255, 0.3);
    }
    
    /* Neon Green Theme */
    body.neon-green {
      --bg-start: #0a0a0a;
      --bg-mid: #0a1a0a;
      --bg-end: #0a0a0a;
      --card-bg: rgba(10, 30, 15, 0.9);
      --input-bg: rgba(15, 40, 20, 0.95);
      --sheet-bg: #0a2a0f;
      --text-primary: #39ff14;
      --text-secondary: #00ff41;
      --text-muted: #00cc33;
      --border-light: rgba(57, 255, 20, 0.2);
      --border-medium: rgba(57, 255, 20, 0.3);
      --accent: #39ff14;
      --accent-light: rgba(57, 255, 20, 0.15);
      --nav-bg: rgba(10, 30, 15, 0.95);
      --glow: 0 0 20px rgba(57, 255, 20, 0.3);
    }
    
    /* Glass Theme */
    body.glass {
      --bg-start: #667eea;
      --bg-mid: #764ba2;
      --bg-end: #f093fb;
      --card-bg: rgba(255, 255, 255, 0.15);
      --input-bg: rgba(255, 255, 255, 0.2);
      --sheet-bg: rgba(255, 255, 255, 0.2);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.8);
      --text-muted: rgba(255, 255, 255, 0.6);
      --border-light: rgba(255, 255, 255, 0.2);
      --border-medium: rgba(255, 255, 255, 0.3);
      --accent: #ffffff;
      --accent-light: rgba(255, 255, 255, 0.2);
      --nav-bg: rgba(255, 255, 255, 0.15);
      --glow: none;
    }
    
    /* Glass Dark Theme */
    body.glass-dark {
      --bg-start: #0f0c29;
      --bg-mid: #302b63;
      --bg-end: #24243e;
      --card-bg: rgba(255, 255, 255, 0.08);
      --input-bg: rgba(255, 255, 255, 0.1);
      --sheet-bg: rgba(30, 30, 50, 0.9);
      --text-primary: #e0e0ff;
      --text-secondary: rgba(224, 224, 255, 0.7);
      --text-muted: rgba(224, 224, 255, 0.5);
      --border-light: rgba(255, 255, 255, 0.1);
      --border-medium: rgba(255, 255, 255, 0.15);
      --accent: #a78bfa;
      --accent-light: rgba(167, 139, 250, 0.2);
      --nav-bg: rgba(30, 30, 50, 0.9);
      --glow: none;
    }
    
    /* Sunset Theme */
    body.sunset {
      --bg-start: #ff6b6b;
      --bg-mid: #feca57;
      --bg-end: #ff9ff3;
      --card-bg: rgba(255, 255, 255, 0.85);
      --input-bg: rgba(255, 255, 255, 0.9);
      --sheet-bg: #fff5f5;
      --text-primary: #2d3436;
      --text-secondary: #636e72;
      --text-muted: #b2bec3;
      --border-light: rgba(0, 0, 0, 0.08);
      --border-medium: rgba(0, 0, 0, 0.12);
      --accent: #e17055;
      --accent-light: rgba(225, 112, 85, 0.15);
      --nav-bg: rgba(255, 255, 255, 0.9);
      --glow: none;
    }
    
    /* Ocean Theme */
    body.ocean {
      --bg-start: #0077b6;
      --bg-mid: #00b4d8;
      --bg-end: #90e0ef;
      --card-bg: rgba(255, 255, 255, 0.9);
      --input-bg: #ffffff;
      --sheet-bg: #ffffff;
      --text-primary: #03045e;
      --text-secondary: #0077b6;
      --text-muted: #48cae4;
      --border-light: rgba(0, 119, 182, 0.15);
      --border-medium: rgba(0, 119, 182, 0.25);
      --accent: #0077b6;
      --accent-light: rgba(0, 119, 182, 0.15);
      --nav-bg: rgba(255, 255, 255, 0.95);
      --glow: none;
    }
    
    html, body { 
      height: 100%; 
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--bg-start), var(--bg-mid), var(--bg-end));
      color: var(--text-primary);
      touch-action: manipulation;
    }
    
    body.locked { overflow: hidden; }
    
    .view { 
      height: 100%; 
      overflow-y: auto; 
      -webkit-overflow-scrolling: touch;
      padding-bottom: calc(80px + env(safe-area-inset-bottom));
      display: none;
    }
    .view.active { display: block; }
    
    /* Header */
    .header {
      padding: calc(env(safe-area-inset-top) + 16px) 16px 12px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .header-title { font-size: 28px; font-weight: 700; text-shadow: var(--glow); }
    .header-subtitle { font-size: 14px; color: var(--text-secondary); margin-top: 2px; }
    .header-actions { display: flex; gap: 8px; }
    .header-btn {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      display: flex; align-items: center; justify-content: center;
      color: var(--text-primary);
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    
    /* Multi-select bar */
    .multi-select-bar {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: calc(env(safe-area-inset-top) + 12px) 16px 12px;
      background: var(--accent);
      color: white;
      z-index: 150;
      justify-content: space-between;
      align-items: center;
    }
    .multi-select-bar.show { display: flex; }
    .multi-select-info { display: flex; align-items: center; gap: 12px; }
    .multi-select-count { font-weight: 600; font-size: 16px; }
    .multi-select-actions { display: flex; gap: 8px; }
    .multi-select-btn {
      width: 40px; height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .multi-select-btn:active { opacity: 0.7; }
    
    /* Search */
    .search-box {
      margin: 0 16px 16px;
      position: relative;
    }
    .search-box input {
      width: 100%;
      padding: 12px 44px;
      font-size: 16px;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      background: var(--input-bg);
      color: var(--text-primary);
      outline: none;
      backdrop-filter: blur(10px);
    }
    .search-box input:focus { border-color: var(--accent); }
    .search-icon, .clear-search {
      position: absolute;
      top: 50%; transform: translateY(-50%);
      color: var(--text-muted);
    }
    .search-icon { left: 14px; pointer-events: none; }
    .clear-search { 
      right: 8px; 
      width: 32px; height: 32px;
      border: none; background: none;
      cursor: pointer; display: none;
      align-items: center; justify-content: center;
    }
    .clear-search.show { display: flex; }
    
    /* Autocomplete */
    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      margin-top: 4px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 100;
      display: none;
      backdrop-filter: blur(20px);
    }
    .autocomplete-list.show { display: block; }
    .autocomplete-item {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid var(--border-light);
      font-size: 14px;
    }
    .autocomplete-item:last-child { border-bottom: none; }
    .autocomplete-item:hover, .autocomplete-item.active { background: var(--accent-light); }
    .autocomplete-type {
      font-size: 11px;
      color: var(--text-muted);
      margin-left: 8px;
    }
    
    /* Stats */
    .stats-row {
      display: flex;
      gap: 12px;
      padding: 0 16px 16px;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .stats-row::-webkit-scrollbar { display: none; }
    .stat-card {
      flex: 0 0 auto;
      min-width: 80px;
      padding: 12px 16px;
      background: var(--card-bg);
      border-radius: 12px;
      text-align: center;
      border: 1px solid var(--border-light);
      backdrop-filter: blur(10px);
      box-shadow: var(--glow);
    }
    .stat-value { font-size: 24px; font-weight: 700; color: var(--accent); text-shadow: var(--glow); }
    .stat-label { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }
    
    /* Filter Pills */
    .filter-row {
      display: flex;
      gap: 8px;
      padding: 0 16px 12px;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .filter-row::-webkit-scrollbar { display: none; }
    .pill {
      flex: 0 0 auto;
      padding: 8px 16px;
      border-radius: 9999px;
      font-size: 13px;
      font-weight: 500;
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
      backdrop-filter: blur(10px);
    }
    .pill.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      box-shadow: var(--glow);
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      margin: 0 16px 16px;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 4px;
      border: 1px solid var(--border-light);
      backdrop-filter: blur(10px);
    }
    .tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3), var(--glow);
    }
    
    /* Content */
    .content-panel { display: none; padding: 0 16px; }
    .content-panel.active { display: block; }
    
    /* Bookmark Card */
    .bookmark-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border-light);
      backdrop-filter: blur(10px);
      position: relative;
      transition: all 0.2s;
    }
    .bookmark-card.selected {
      border-color: var(--accent);
      background: var(--accent-light);
    }
    .bookmark-card .select-checkbox {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border-medium);
      background: var(--card-bg);
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .bookmark-card.selectable .select-checkbox { display: flex; }
    .bookmark-card.selected .select-checkbox {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    .bookmark-header {
      display: flex;
      gap: 12px;
    }
    .bookmark-thumb {
      width: 80px; height: 80px;
      border-radius: 10px;
      object-fit: cover;
      background: var(--border-light);
      flex-shrink: 0;
    }
    .bookmark-info { flex: 1; min-width: 0; }
    .bookmark-meta {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }
    .meta-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 4px;
      background: var(--accent-light);
      color: var(--accent);
      font-weight: 500;
    }
    .bookmark-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-decoration: none;
      line-height: 1.3;
    }
    .bookmark-title:hover { text-decoration: underline; }
    .bookmark-url {
      font-size: 13px;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-top: 2px;
    }
    .bookmark-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .tag {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 6px;
      background: var(--border-light);
      color: var(--text-secondary);
    }
    .bookmark-notes {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 10px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.5;
    }
    .bookmark-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .action-btn {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border-light);
      background: var(--input-bg);
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      text-decoration: none;
    }
    .action-btn:active { opacity: 0.7; }
    
    /* Snippet Card */
    .snippet-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border-light);
      cursor: pointer;
      backdrop-filter: blur(10px);
      position: relative;
    }
    .snippet-card.selected {
      border-color: var(--accent);
      background: var(--accent-light);
    }
    .snippet-card .select-checkbox {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border-medium);
      background: var(--card-bg);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .snippet-card.selectable .select-checkbox { display: flex; }
    .snippet-card.selected .select-checkbox {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    .snippet-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    .snippet-title { font-size: 15px; font-weight: 600; }
    .snippet-folder { font-size: 11px; color: var(--accent); }
    .snippet-content {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      white-space: pre-wrap;
      display: -webkit-box;
      -webkit-line-clamp: 4;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    /* Image Grid */
    .image-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .image-card {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-light);
      cursor: pointer;
      backdrop-filter: blur(10px);
      position: relative;
    }
    .image-card.selected {
      border-color: var(--accent);
    }
    .image-card .select-checkbox {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid white;
      background: rgba(0,0,0,0.3);
      display: none;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 2;
    }
    .image-card.selectable .select-checkbox { display: flex; }
    .image-card.selected .select-checkbox {
      background: var(--accent);
      border-color: var(--accent);
    }
    .image-card img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
    }
    .image-card-title {
      padding: 10px;
      font-size: 13px;
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
    }
    .empty-icon { margin-bottom: 12px; opacity: 0.5; }
    .empty-title { font-size: 16px; font-weight: 500; margin-bottom: 4px; }
    .empty-text { font-size: 14px; }
    
    /* Load More / Index Info */
    .load-more {
      display: none;
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      color: var(--accent);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    .load-more.show { display: block; }
    
    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(65px + env(safe-area-inset-bottom));
      padding-bottom: env(safe-area-inset-bottom);
      background: var(--nav-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid var(--border-light);
      display: flex;
      z-index: 100;
    }
    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: var(--text-muted);
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
    }
    .nav-btn.active { color: var(--accent); }
    .nav-label { font-size: 11px; font-weight: 500; }
    
    /* FAB */
    .fab {
      position: fixed;
      bottom: calc(80px + env(safe-area-inset-bottom));
      right: 20px;
      width: 60px; height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 80%, black));
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), var(--glow);
      z-index: 99;
    }
    .fab:active { transform: scale(0.95); }
    
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 200;
      display: none;
    }
    .modal.open { display: flex; flex-direction: column; }
    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
    }
    .modal-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      max-height: 95vh;
      background: var(--sheet-bg);
      border-radius: 20px 20px 0 0;
      display: flex;
      flex-direction: column;
      animation: slideUp 0.3s ease;
      backdrop-filter: blur(20px);
    }
    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    .modal-handle {
      width: 40px; height: 4px;
      background: var(--border-medium);
      border-radius: 2px;
      margin: 8px auto;
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 16px 16px;
      border-bottom: 1px solid var(--border-light);
    }
    .modal-title { font-size: 18px; font-weight: 600; }
    .modal-btn {
      padding: 8px 16px;
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    .modal-cancel { color: var(--text-secondary); }
    .modal-save { color: var(--accent); font-weight: 600; }
    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
    }
    
    /* Form */
    .form-group { margin-bottom: 16px; }
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      background: var(--input-bg);
      color: var(--text-primary);
      outline: none;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--accent);
    }
    .form-textarea { resize: vertical; min-height: 80px; }
    .form-row { display: flex; gap: 12px; }
    .form-row > * { flex: 1; }
    .form-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 20px 0;
      color: var(--text-muted);
      font-size: 13px;
    }
    .form-divider::before, .form-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-light);
    }
    .upload-area {
      border: 2px dashed var(--border-medium);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      color: var(--text-muted);
      cursor: pointer;
    }
    .upload-area:hover { border-color: var(--accent); }
    .image-preview {
      position: relative;
      margin-top: 12px;
    }
    .image-preview img {
      width: 100%;
      max-height: 200px;
      object-fit: contain;
      border-radius: 8px;
    }
    .remove-image {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px; height: 32px;
      border-radius: 50%;
      background: rgba(0,0,0,0.6);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Settings */
    .settings-header {
      display: flex;
      align-items: center;
      padding: calc(env(safe-area-inset-top) + 12px) 16px 12px;
      gap: 12px;
    }
    .back-btn {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      cursor: pointer;
    }
    .settings-title { font-size: 20px; font-weight: 600; }
    .settings-section {
      padding: 0 16px;
      margin-bottom: 24px;
    }
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    .settings-card {
      background: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--border-light);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      cursor: pointer;
      border-bottom: 1px solid var(--border-light);
    }
    .settings-item:last-child { border-bottom: none; }
    .settings-item:active { background: var(--border-light); }
    .settings-item-label { font-size: 16px; }
    .settings-item-value {
      font-size: 14px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .settings-item.danger .settings-item-label { color: var(--danger); }
    .github-inputs { padding: 16px; }
    .github-inputs .form-group { margin-bottom: 12px; }
    .github-inputs .form-group:last-child { margin-bottom: 0; }
    .github-buttons {
      display: flex;
      gap: 12px;
      padding: 0 16px 16px;
    }
    .github-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
    .github-btn.pull {
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
    }
    .github-btn.push {
      background: var(--accent);
      color: white;
    }
    .github-status {
      padding: 0 16px 16px;
      font-size: 13px;
      color: var(--text-muted);
    }
    
    /* Help Section */
    .help-content {
      padding: 16px;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-secondary);
    }
    .help-content h3 {
      color: var(--text-primary);
      font-size: 16px;
      margin: 16px 0 8px;
    }
    .help-content h3:first-child { margin-top: 0; }
    .help-content p { margin-bottom: 12px; }
    .help-content code {
      background: var(--border-light);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
    }
    .help-content ul {
      margin-left: 20px;
      margin-bottom: 12px;
    }
    .help-content li { margin-bottom: 4px; }
    
    /* Sheets */
    .sheet {
      position: fixed;
      inset: 0;
      z-index: 200;
      display: none;
    }
    .sheet.open { display: block; }
    .sheet-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
    }
    .sheet-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--sheet-bg);
      border-radius: 20px 20px 0 0;
      padding: 20px;
      padding-bottom: calc(20px + env(safe-area-inset-bottom));
      animation: slideUp 0.3s ease;
      max-height: 80vh;
      overflow-y: auto;
      backdrop-filter: blur(20px);
    }
    .sheet-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      text-align: center;
    }
    .sheet-preview {
      background: var(--input-bg);
      border: 1px solid var(--border-light);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 16px;
      max-height: 120px;
      overflow-y: auto;
      font-size: 14px;
      color: var(--text-secondary);
      word-break: break-all;
    }
    .sheet-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .sheet-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      cursor: pointer;
      color: var(--text-primary);
    }
    .sheet-btn:active { opacity: 0.7; }
    .sheet-btn span { font-size: 13px; }
    .theme-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .theme-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 16px 12px;
      border-radius: 12px;
      cursor: pointer;
      background: var(--card-bg);
      border: 2px solid var(--border-light);
    }
    .theme-option.active { border-color: var(--accent); }
    .theme-preview {
      width: 48px; height: 48px;
      border-radius: 50%;
      border: 2px solid var(--border-medium);
    }
    .theme-name { font-size: 12px; font-weight: 500; }
    .theme-light { background: linear-gradient(135deg, #fffbeb, #fef3c7); }
    .theme-dark { background: linear-gradient(135deg, #0f172a, #1e293b); }
    .theme-neon-pink { background: linear-gradient(135deg, #ff6ec7, #9d4edd); }
    .theme-neon-cyan { background: linear-gradient(135deg, #00ffff, #00a8cc); }
    .theme-neon-green { background: linear-gradient(135deg, #39ff14, #00cc33); }
    .theme-glass { background: linear-gradient(135deg, #667eea, #f093fb); }
    .theme-glass-dark { background: linear-gradient(135deg, #302b63, #24243e); }
    .theme-sunset { background: linear-gradient(135deg, #ff6b6b, #feca57); }
    .theme-ocean { background: linear-gradient(135deg, #0077b6, #90e0ef); }
    
    .folder-list { margin-top: 8px; }
    .folder-item {
      display: flex;
      justify-content: space-between;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      margin-bottom: 4px;
    }
    .folder-item:hover { background: var(--border-light); }
    .folder-item.active { background: var(--accent-light); }
    .folder-count { color: var(--text-muted); font-size: 14px; }
    .action-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      margin-bottom: 4px;
    }
    .action-item:hover { background: var(--border-light); }
    .action-item.danger { color: var(--danger); }
    
    /* Move to Folder Sheet */
    .move-folder-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      margin-bottom: 4px;
    }
    .move-folder-item:hover { background: var(--border-light); }
    .move-folder-item svg { color: var(--accent); }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: calc(80px + env(safe-area-inset-bottom));
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--text-primary);
      color: var(--bg-start);
      padding: 12px 24px;
      border-radius: 9999px;
      font-size: 14px;
      font-weight: 500;
      z-index: 300;
      opacity: 0;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    /* Paste Prompt */
    .paste-prompt {
      position: fixed;
      inset: 0;
      z-index: 250;
      background: rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .paste-prompt.open { display: flex; }
    .paste-prompt textarea {
      width: 100%;
      max-width: 400px;
      height: 150px;
      padding: 16px;
      font-size: 16px;
      border: 2px solid var(--accent);
      border-radius: 12px;
      background: var(--sheet-bg);
      color: var(--text-primary);
      resize: none;
    }
    .paste-prompt p {
      color: white;
      margin-bottom: 16px;
      text-align: center;
    }
    .paste-prompt-close {
      margin-top: 16px;
      padding: 12px 24px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    
    /* Utilities */
    .hidden { display: none !important; }
    
    /* Datalist styling */
    datalist { display: none; }
  </style>
</head>
<body>
  <!-- Multi-Select Bar -->
  <div class="multi-select-bar" id="multiSelectBar">
    <div class="multi-select-info">
      <button class="multi-select-btn" onclick="exitMultiSelect()" aria-label="Cancel">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"></path></svg>
      </button>
      <span class="multi-select-count" id="selectCount">0 selected</span>
    </div>
    <div class="multi-select-actions">
      <button class="multi-select-btn" onclick="selectAll()" aria-label="Select All">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
      </button>
      <button class="multi-select-btn" onclick="showMoveSheet()" aria-label="Move">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
      </button>
      <button class="multi-select-btn" onclick="deleteMultiple()" aria-label="Delete">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
      </button>
    </div>
  </div>

  <!-- Home View -->
  <div id="homeView" class="view active">
    <div class="header">
      <div>
        <div class="header-title">Mani's Bookmark Vault</div>
        <div class="header-subtitle" id="itemCount">0 items</div>
      </div>
      <div class="header-actions">
        <button class="header-btn" id="selectModeBtn" aria-label="Select">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
        </button>
        <button class="header-btn" id="settingsBtn" aria-label="Settings">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
      </div>
    </div>
    
    <div class="search-box">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
      <input type="search" id="searchInput" placeholder="Search bookmarks, snippets, images..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      <button class="clear-search" id="clearSearch" aria-label="Clear search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"></path></svg>
      </button>
      <div class="autocomplete-list" id="autocompleteList"></div>
    </div>
    
    <div class="stats-row" id="statsRow">
      <div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Total</div></div>
      <div class="stat-card"><div class="stat-value" id="statToday">0</div><div class="stat-label">Today</div></div>
      <div class="stat-card"><div class="stat-value" id="statWeek">0</div><div class="stat-label">Week</div></div>
      <div class="stat-card"><div class="stat-value" id="statFolders">0</div><div class="stat-label">Folders</div></div>
    </div>
    
    <div class="filter-row" id="platformFilters"></div>
    <div class="filter-row" id="folderFilters"></div>
    
    <div class="tabs">
      <div class="tab active" data-tab="bookmarks">Bookmarks</div>
      <div class="tab" data-tab="snippets">Snippets</div>
      <div class="tab" data-tab="images">Images</div>
    </div>
    
    <div id="bookmarksPanel" class="content-panel active"></div>
    <div id="snippetsPanel" class="content-panel"></div>
    <div id="imagesPanel" class="content-panel"></div>
  </div>
  
  <!-- Settings View -->
  <div id="settingsView" class="view">
    <div class="settings-header">
      <button class="back-btn" id="backBtn" aria-label="Back">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
      </button>
      <div class="settings-title">Settings</div>
    </div>
    
    <div class="settings-section">
      <div class="section-title">Appearance</div>
      <div class="settings-card">
        <div class="settings-item" id="themeBtn">
          <span class="settings-item-label">Theme</span>
          <span class="settings-item-value">
            <span id="themeLabel">Light</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"></path></svg>
          </span>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="section-title">Data</div>
      <div class="settings-card">
        <div class="settings-item" id="exportBtn">
          <span class="settings-item-label">Export Data</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        </div>
        <label class="settings-item">
          <span class="settings-item-label">Import Data</span>
          <input type="file" id="importInput" accept=".json" style="display:none">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
        </label>
        <div class="settings-item danger" id="clearBtn">
          <span class="settings-item-label">Clear All Data</span>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="section-title">GitHub Sync</div>
      <div class="settings-card">
        <div class="settings-item" id="helpBtn">
          <span class="settings-item-label">ðŸ“– Setup Guide & Help</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"></path></svg>
        </div>
        <div class="github-inputs">
          <div class="form-group">
            <label class="form-label">Owner (GitHub username)</label>
            <input type="text" class="form-input" id="ghOwner" placeholder="your-username">
          </div>
          <div class="form-group">
            <label class="form-label">Repository Name</label>
            <input type="text" class="form-input" id="ghRepo" placeholder="bookmark-vault-data">
          </div>
          <div class="form-group">
            <label class="form-label">File Path</label>
            <input type="text" class="form-input" id="ghPath" placeholder="data/bookmarks.json">
          </div>
          <div class="form-group">
            <label class="form-label">Personal Access Token</label>
            <input type="password" class="form-input" id="ghToken" placeholder="ghp_xxxxxxxxxxxx">
          </div>
        </div>
        <div class="github-buttons">
          <button class="github-btn pull" id="ghPull">Pull from GitHub</button>
          <button class="github-btn push" id="ghPush">Push to GitHub</button>
        </div>
        <div class="github-status" id="ghStatus"></div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="section-title">About</div>
      <div class="settings-card">
        <div class="settings-item" style="cursor:default">
          <span class="settings-item-label">Mani's Bookmark Vault</span>
          <span class="settings-item-value">v2.2</span>
        </div>
        <div class="settings-item" id="installBtn">
          <span class="settings-item-label">Install App</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add/Edit Modal -->
  <div id="addModal" class="modal">
    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="modal-content">
      <div class="modal-handle"></div>
      <div class="modal-header">
        <button class="modal-btn modal-cancel" id="modalCancel">Cancel</button>
        <div class="modal-title" id="modalTitle">Add Bookmark</div>
        <button class="modal-btn modal-save" id="modalSave">Save</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">URL</label>
          <input type="url" class="form-input" id="formUrl" placeholder="https://example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" class="form-input" id="formTitle" placeholder="Page title">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Platform</label>
            <select class="form-select" id="formPlatform">
              <option value="Article">Article</option>
              <option value="YouTube">YouTube</option>
              <option value="Podcast">Podcast</option>
              <option value="Tweet">Tweet</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Folder</label>
            <input type="text" class="form-input" id="formFolder" placeholder="General" list="folderList">
            <datalist id="folderList"></datalist>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Tags (comma separated)</label>
          <input type="text" class="form-input" id="formTags" placeholder="tag1, tag2">
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-textarea" id="formNotes" placeholder="Your notes..."></textarea>
        </div>
        
        <div class="form-divider">Text Snippet</div>
        <div class="form-group">
          <label class="form-label">Snippet Title</label>
          <input type="text" class="form-input" id="formSnippetTitle" placeholder="Snippet name">
        </div>
        <div class="form-group">
          <label class="form-label">Snippet Content</label>
          <textarea class="form-textarea" id="formSnippetContent" placeholder="Text content..."></textarea>
        </div>
        
        <div class="form-divider">Image</div>
        <div class="form-group">
          <label class="form-label">Image Title</label>
          <input type="text" class="form-input" id="formImageTitle" placeholder="Image name">
        </div>
        <div class="form-group">
          <label class="form-label">Image URL</label>
          <input type="url" class="form-input" id="formImageUrl" placeholder="https://example.com/image.jpg">
        </div>
        <div class="upload-area" id="uploadArea">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
          <p style="margin-top:8px">Tap to upload image</p>
          <input type="file" id="imageInput" accept="image/*" style="display:none">
        </div>
        <div class="image-preview hidden" id="imagePreview">
          <img id="previewImg" src="" alt="Preview">
          <button class="remove-image" id="removeImage" aria-label="Remove image">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"></path></svg>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- FAB -->
  <button class="fab" id="fab" aria-label="Add bookmark">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"></path></svg>
  </button>
  
  <!-- Bottom Navigation -->
  <nav class="bottom-nav" id="bottomNav">
    <button class="nav-btn active" data-nav="home" aria-label="Home">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      <span class="nav-label">Home</span>
    </button>
    <button class="nav-btn" data-nav="search" aria-label="Search">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
      <span class="nav-label">Search</span>
    </button>
    <button class="nav-btn" data-nav="clip" aria-label="Clipboard">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
      <span class="nav-label">Clip</span>
    </button>
    <button class="nav-btn" data-nav="folders" aria-label="Folders">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
      <span class="nav-label">Folders</span>
    </button>
  </nav>
  
  <!-- Clipboard Sheet -->
  <div id="clipSheet" class="sheet">
    <div class="sheet-backdrop" onclick="closeAllSheets()"></div>
    <div class="sheet-content">
      <div class="sheet-title">Clipboard Content</div>
      <div class="sheet-preview" id="clipPreview"></div>
      <div class="sheet-actions">
        <button class="sheet-btn" onclick="handleClipAction('bookmark')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
          <span>Bookmark</span>
        </button>
        <button class="sheet-btn" onclick="handleClipAction('snippet')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
          <span>Snippet</span>
        </button>
        <button class="sheet-btn" onclick="handleClipAction('image')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
          <span>Image URL</span>
        </button>
        <button class="sheet-btn" onclick="closeAllSheets()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"></path></svg>
          <span>Dismiss</span>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Theme Sheet -->
  <div id="themeSheet" class="sheet">
    <div class="sheet-backdrop" onclick="closeAllSheets()"></div>
    <div class="sheet-content">
      <div class="sheet-title">Choose Theme</div>
      <div class="theme-grid">
        <div class="theme-option" onclick="setTheme('light')">
          <div class="theme-preview theme-light"></div>
          <span class="theme-name">Light</span>
        </div>
        <div class="theme-option" onclick="setTheme('dark')">
          <div class="theme-preview theme-dark"></div>
          <span class="theme-name">Dark</span>
        </div>
        <div class="theme-option" onclick="setTheme('neon-pink')">
          <div class="theme-preview theme-neon-pink"></div>
          <span class="theme-name">Neon Pink</span>
        </div>
        <div class="theme-option" onclick="setTheme('neon-cyan')">
          <div class="theme-preview theme-neon-cyan"></div>
          <span class="theme-name">Neon Cyan</span>
        </div>
        <div class="theme-option" onclick="setTheme('neon-green')">
          <div class="theme-preview theme-neon-green"></div>
          <span class="theme-name">Neon Green</span>
        </div>
        <div class="theme-option" onclick="setTheme('glass')">
          <div class="theme-preview theme-glass"></div>
          <span class="theme-name">Glass</span>
        </div>
        <div class="theme-option" onclick="setTheme('glass-dark')">
          <div class="theme-preview theme-glass-dark"></div>
          <span class="theme-name">Glass Dark</span>
        </div>
        <div class="theme-option" onclick="setTheme('sunset')">
          <div class="theme-preview theme-sunset"></div>
          <span class="theme-name">Sunset</span>
        </div>
        <div class="theme-option" onclick="setTheme('ocean')">
          <div class="theme-preview theme-ocean"></div>
          <span class="theme-name">Ocean</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Folder Sheet -->
  <div id="folderSheet" class="sheet">
    <div class="sheet-backdrop" onclick="closeAllSheets()"></div>
    <div class="sheet-content">
      <div class="sheet-title">Select Folder</div>
      <div class="folder-list" id="folderList2"></div>
    </div>
  </div>
  
  <!-- Move to Folder Sheet -->
  <div id="moveSheet" class="sheet">
    <div class="sheet-backdrop" onclick="closeAllSheets()"></div>
    <div class="sheet-content">
      <div class="sheet-title">Move to Folder</div>
      <div class="form-group" style="margin-bottom:16px">
        <input type="text" class="form-input" id="newFolderInput" placeholder="Create new folder...">
      </div>
      <div class="folder-list" id="moveFolderList"></div>
    </div>
  </div>
  
  <!-- Action Sheet -->
  <div id="actionSheet" class="sheet">
    <div class="sheet-backdrop" onclick="closeAllSheets()"></div>
    <div class="sheet-content">
      <div class="sheet-title" id="actionTitle">Actions</div>
      <div class="action-item" onclick="editSelected()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
        <span>Edit</span>
      </div>
      <div class="action-item" onclick="copySelected()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
        <span>Copy Link</span>
      </div>
      <div class="action-item" onclick="shareSelected()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
        <span>Share</span>
      </div>
      <div class="action-item" onclick="moveSelectedSingle()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
        <span>Move to Folder</span>
      </div>
      <div class="action-item danger" onclick="deleteSelected()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
        <span>Delete</span>
      </div>
    </div>
  </div>
  
  <!-- Help Sheet -->
  <div id="helpSheet" class="sheet">
    <div class="sheet-backdrop" onclick="closeAllSheets()"></div>
    <div class="sheet-content">
      <div class="sheet-title">ðŸ“– Setup Guide & Help</div>
      <div class="help-content">
        <h3>ðŸ”„ GitHub Sync Setup</h3>
        <p>Sync your bookmarks across devices using a GitHub repository:</p>
        <ul>
          <li><strong>Owner:</strong> Your GitHub username (e.g., <code>johndoe</code>)</li>
          <li><strong>Repository:</strong> Create a new repo like <code>bookmark-vault-data</code></li>
          <li><strong>Path:</strong> File path in repo (e.g., <code>data/bookmarks.json</code>)</li>
          <li><strong>Token:</strong> Personal Access Token with <code>repo</code> scope</li>
        </ul>
        
        <h3>ðŸ”‘ Creating a Personal Access Token</h3>
        <ul>
          <li>Go to GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Tokens (classic)</li>
          <li>Click "Generate new token (classic)"</li>
          <li>Give it a name and select the <code>repo</code> scope</li>
          <li>Copy the token (starts with <code>ghp_</code>)</li>
        </ul>
        
        <h3>ðŸŒ Deploy with GitHub Pages</h3>
        <p>Host this app for free:</p>
        <ul>
          <li>Create a new repository</li>
          <li>Upload <code>index.html</code> to the repo</li>
          <li>Go to Settings â†’ Pages</li>
          <li>Set Source to "Deploy from a branch"</li>
          <li>Select <code>main</code> branch and <code>/ (root)</code></li>
          <li>Your app will be at <code>https://username.github.io/repo-name/</code></li>
        </ul>
        
        <h3>ðŸ“¤ Share from Other Apps</h3>
        <p>When you install this as a PWA:</p>
        <ul>
          <li>Install the app to your home screen</li>
          <li>When sharing a link from any app (browser, YouTube, etc.), select "Mani's Bookmark Vault"</li>
          <li>The shared URL/text will auto-populate in the add form</li>
        </ul>
        
        <h3>ðŸ“± Install as PWA</h3>
        <ul>
          <li><strong>iOS:</strong> Tap Share â†’ "Add to Home Screen"</li>
          <li><strong>Android:</strong> Tap menu â†’ "Install app" or "Add to Home Screen"</li>
          <li><strong>Desktop:</strong> Click the install icon in the address bar</li>
        </ul>
        
        <h3>âœ¨ Features</h3>
        <ul>
          <li><strong>Multi-select:</strong> Tap the checkbox icon to select multiple items for bulk delete or move</li>
          <li><strong>Search:</strong> Autocomplete suggestions from all your bookmarks, snippets, and images</li>
          <li><strong>Themes:</strong> 9 beautiful themes including neon and glass effects</li>
          <li><strong>Offline:</strong> Works without internet, data stored locally</li>
        </ul>
      </div>
    </div>
  </div>
  
  <!-- Paste Prompt -->
  <div id="pastePrompt" class="paste-prompt">
    <p>Clipboard access denied. Please paste your content below:</p>
    <textarea id="pasteArea" placeholder="Paste here..."></textarea>
    <button class="paste-prompt-close" onclick="closePastePrompt()">Done</button>
  </div>
  
  <!-- Toast -->
  <div id="toast" class="toast"></div>
  
  <script>
    // State
    const state = {
      bookmarks: [],
      theme: 'light',
      filter: { platform: 'All', folder: 'All', search: '' },
      tab: 'bookmarks',
      page: 1,
      editId: null,
      selectedId: null,
      selectedIds: new Set(),
      selectMode: false,
      clipboardContent: '',
      imageData: '',
      github: { owner: '', repo: '', path: '', token: '', sha: '' }
    };
    
    let deferredPrompt = null;
    const PAGE_SIZE = 30;
    const THEMES = ['light', 'dark', 'neon-pink', 'neon-cyan', 'neon-green', 'glass', 'glass-dark', 'sunset', 'ocean'];
    const THEME_LABELS = {
      'light': 'Light',
      'dark': 'Dark',
      'neon-pink': 'Neon Pink',
      'neon-cyan': 'Neon Cyan',
      'neon-green': 'Neon Green',
      'glass': 'Glass',
      'glass-dark': 'Glass Dark',
      'sunset': 'Sunset',
      'ocean': 'Ocean'
    };
    
    // Initialization
    function init() {
      loadData();
      applyTheme();
      setupEvents();
      render();
      setupPWA();
      checkShareTarget();
    }
    
    function loadData() {
      try {
        const saved = localStorage.getItem('bookmarks');
        if (saved) {
          const data = JSON.parse(saved);
          state.bookmarks = Array.isArray(data) ? data : (data.bookmarks || []);
        }
        state.theme = localStorage.getItem('theme') || 'light';
        const gh = localStorage.getItem('github');
        if (gh) {
          state.github = { ...state.github, ...JSON.parse(gh) };
          document.getElementById('ghOwner').value = state.github.owner || '';
          document.getElementById('ghRepo').value = state.github.repo || '';
          document.getElementById('ghPath').value = state.github.path || '';
          document.getElementById('ghToken').value = state.github.token || '';
        }
      } catch (e) {
        console.error('Load error:', e);
      }
    }
    
    function saveData() {
      try {
        localStorage.setItem('bookmarks', JSON.stringify(state.bookmarks));
        localStorage.setItem('theme', state.theme);
        localStorage.setItem('github', JSON.stringify(state.github));
      } catch (e) {
        console.error('Save error:', e);
        toast('Save failed - storage full');
      }
    }
    
    function setupEvents() {
      // Navigation
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.onclick = () => handleNav(btn.dataset.nav);
      });
      
      // FAB
      document.getElementById('fab').onclick = openAddModal;
      
      // Settings
      document.getElementById('settingsBtn').onclick = () => showView('settings');
      document.getElementById('backBtn').onclick = () => showView('home');
      
      // Select mode
      document.getElementById('selectModeBtn').onclick = toggleSelectMode;
      
      // Search with autocomplete
      const searchInput = document.getElementById('searchInput');
      const clearSearch = document.getElementById('clearSearch');
      const autocomplete = document.getElementById('autocompleteList');
      
      searchInput.oninput = () => {
        state.filter.search = searchInput.value;
        clearSearch.classList.toggle('show', searchInput.value.length > 0);
        state.page = 1;
        renderContent();
        showAutocomplete(searchInput.value);
      };
      
      searchInput.onfocus = () => {
        if (searchInput.value) showAutocomplete(searchInput.value);
      };
      
      searchInput.onblur = () => {
        setTimeout(() => autocomplete.classList.remove('show'), 200);
      };
      
      clearSearch.onclick = () => {
        searchInput.value = '';
        state.filter.search = '';
        clearSearch.classList.remove('show');
        autocomplete.classList.remove('show');
        state.page = 1;
        renderContent();
      };
      
      // Tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => switchTab(tab.dataset.tab);
      });
      
      // Modal
      document.getElementById('modalBackdrop').onclick = closeAddModal;
      document.getElementById('modalCancel').onclick = closeAddModal;
      document.getElementById('modalSave').onclick = saveBookmark;
      
      // URL metadata fetch
      document.getElementById('formUrl').onblur = fetchMetadata;
      
      // Image upload
      document.getElementById('uploadArea').onclick = () => document.getElementById('imageInput').click();
      document.getElementById('imageInput').onchange = handleImageUpload;
      document.getElementById('removeImage').onclick = removeImage;
      
      // Settings actions
      document.getElementById('themeBtn').onclick = () => openSheet('themeSheet');
      document.getElementById('exportBtn').onclick = exportData;
      document.getElementById('importInput').onchange = importData;
      document.getElementById('clearBtn').onclick = clearAllData;
      document.getElementById('installBtn').onclick = installPWA;
      document.getElementById('helpBtn').onclick = () => openSheet('helpSheet');
      
      // GitHub
      ['ghOwner', 'ghRepo', 'ghPath', 'ghToken'].forEach(id => {
        document.getElementById(id).onchange = (e) => {
          state.github[id.replace('gh', '').toLowerCase()] = e.target.value;
          saveData();
        };
      });
      document.getElementById('ghPull').onclick = pullGitHub;
      document.getElementById('ghPush').onclick = pushGitHub;
      
      // New folder input in move sheet
      document.getElementById('newFolderInput').onkeydown = (e) => {
        if (e.key === 'Enter') {
          const folder = e.target.value.trim();
          if (folder) {
            moveToFolder(folder);
            e.target.value = '';
          }
        }
      };
      
      // Load more
      document.getElementById('bookmarksPanel').addEventListener('click', (e) => {
        if (e.target.classList.contains('load-more')) {
          state.page++;
          renderBookmarks();
        }
      });
      
      // PWA install prompt
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
      });
    }
    
    // Autocomplete
    function showAutocomplete(query) {
      const autocomplete = document.getElementById('autocompleteList');
      if (!query || query.length < 2) {
        autocomplete.classList.remove('show');
        return;
      }
      
      const q = query.toLowerCase();
      const suggestions = [];
      const seen = new Set();
      
      state.bookmarks.forEach(b => {
        // Check title
        if (b.title && b.title.toLowerCase().includes(q) && !seen.has(b.title)) {
          suggestions.push({ text: b.title, type: 'Bookmark' });
          seen.add(b.title);
        }
        // Check snippet title
        if (b.snippetTitle && b.snippetTitle.toLowerCase().includes(q) && !seen.has(b.snippetTitle)) {
          suggestions.push({ text: b.snippetTitle, type: 'Snippet' });
          seen.add(b.snippetTitle);
        }
        // Check image title
        if (b.imageTitle && b.imageTitle.toLowerCase().includes(q) && !seen.has(b.imageTitle)) {
          suggestions.push({ text: b.imageTitle, type: 'Image' });
          seen.add(b.imageTitle);
        }
        // Check tags
        (b.tags || []).forEach(tag => {
          if (tag.toLowerCase().includes(q) && !seen.has(tag)) {
            suggestions.push({ text: tag, type: 'Tag' });
            seen.add(tag);
          }
        });
        // Check folder
        if (b.folder && b.folder.toLowerCase().includes(q) && !seen.has(b.folder)) {
          suggestions.push({ text: b.folder, type: 'Folder' });
          seen.add(b.folder);
        }
      });
      
      if (suggestions.length === 0) {
        autocomplete.classList.remove('show');
        return;
      }
      
      autocomplete.innerHTML = suggestions.slice(0, 8).map(s => 
        `<div class="autocomplete-item" onclick="selectAutocomplete('${esc(s.text)}')">${esc(s.text)}<span class="autocomplete-type">${s.type}</span></div>`
      ).join('');
      autocomplete.classList.add('show');
    }
    
    function selectAutocomplete(text) {
      const searchInput = document.getElementById('searchInput');
      searchInput.value = text;
      state.filter.search = text;
      document.getElementById('autocompleteList').classList.remove('show');
      document.getElementById('clearSearch').classList.add('show');
      state.page = 1;
      renderContent();
    }
    
    // Multi-select
    function toggleSelectMode() {
      state.selectMode = !state.selectMode;
      state.selectedIds.clear();
      updateSelectUI();
      renderContent();
    }
    
    function exitMultiSelect() {
      state.selectMode = false;
      state.selectedIds.clear();
      updateSelectUI();
      renderContent();
    }
    
    function updateSelectUI() {
      document.getElementById('multiSelectBar').classList.toggle('show', state.selectMode);
      document.getElementById('selectCount').textContent = `${state.selectedIds.size} selected`;
    }
    
    function toggleSelect(id) {
      if (state.selectedIds.has(id)) {
        state.selectedIds.delete(id);
      } else {
        state.selectedIds.add(id);
      }
      updateSelectUI();
      renderContent();
    }
    
    function selectAll() {
      const filtered = getFiltered();
      if (state.tab === 'bookmarks') {
        filtered.filter(b => b.url).forEach(b => state.selectedIds.add(b.id));
      } else if (state.tab === 'snippets') {
        filtered.filter(b => b.snippetContent).forEach(b => state.selectedIds.add(b.id));
      } else if (state.tab === 'images') {
        filtered.filter(b => b.imageData || b.imageUrl).forEach(b => state.selectedIds.add(b.id));
      }
      updateSelectUI();
      renderContent();
    }
    
    function deleteMultiple() {
      const count = state.selectedIds.size;
      if (count === 0) return;
      
      state.bookmarks = state.bookmarks.filter(b => !state.selectedIds.has(b.id));
      saveData();
      toast(`Deleted ${count} item${count > 1 ? 's' : ''}`);
      exitMultiSelect();
      render();
    }
    
    function showMoveSheet() {
      if (state.selectedIds.size === 0) {
        toast('No items selected');
        return;
      }
      renderMoveFolderList();
      openSheet('moveSheet');
    }
    
    function renderMoveFolderList() {
      const folders = new Set(['General']);
      state.bookmarks.forEach(b => folders.add(b.folder || 'General'));
      
      const html = Array.from(folders).sort().map(f => `
        <div class="move-folder-item" onclick="moveToFolder('${esc(f)}')">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
          <span>${esc(f)}</span>
        </div>
      `).join('');
      
      document.getElementById('moveFolderList').innerHTML = html;
    }
    
    function moveToFolder(folder) {
      const ids = state.selectMode ? state.selectedIds : new Set([state.selectedId]);
      let count = 0;
      
      state.bookmarks.forEach(b => {
        if (ids.has(b.id)) {
          b.folder = folder;
          count++;
        }
      });
      
      saveData();
      closeAllSheets();
      toast(`Moved ${count} item${count > 1 ? 's' : ''} to ${folder}`);
      
      if (state.selectMode) {
        exitMultiSelect();
      }
      render();
    }
    
    function moveSelectedSingle() {
      closeAllSheets();
      state.selectedIds = new Set([state.selectedId]);
      renderMoveFolderList();
      openSheet('moveSheet');
    }
    
    function handleNav(navType) {
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.nav === navType);
      });
      
      if (navType === 'home') {
        showView('home');
        resetFilters();
      } else if (navType === 'search') {
        showView('home');
        document.getElementById('searchInput').focus();
      } else if (navType === 'clip') {
        readClipboard();
      } else if (navType === 'folders') {
        showFolderSheet();
      }
    }
    
    function showView(viewName) {
      document.getElementById('homeView').classList.toggle('active', viewName === 'home');
      document.getElementById('settingsView').classList.toggle('active', viewName === 'settings');
      document.getElementById('fab').classList.toggle('hidden', viewName !== 'home');
      document.getElementById('bottomNav').classList.toggle('hidden', viewName !== 'home');
      if (viewName === 'home' && state.selectMode) {
        document.getElementById('multiSelectBar').classList.add('show');
      } else {
        document.getElementById('multiSelectBar').classList.remove('show');
      }
    }
    
    function switchTab(tabName) {
      state.tab = tabName;
      state.page = 1;
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
      document.getElementById(tabName + 'Panel').classList.add('active');
      renderContent();
    }
    
    function resetFilters() {
      state.filter = { platform: 'All', folder: 'All', search: '' };
      document.getElementById('searchInput').value = '';
      document.getElementById('clearSearch').classList.remove('show');
      document.getElementById('autocompleteList').classList.remove('show');
      state.page = 1;
      render();
    }
    
    // Rendering
    function render() {
      renderStats();
      renderPlatforms();
      renderFolders();
      renderContent();
      updateFolderDatalist();
    }
    
    function renderStats() {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
      
      const total = state.bookmarks.length;
      const todayCount = state.bookmarks.filter(b => new Date(b.createdAt) >= today).length;
      const weekCount = state.bookmarks.filter(b => new Date(b.createdAt) >= weekAgo).length;
      const folders = new Set(state.bookmarks.map(b => b.folder || 'General')).size;
      
      document.getElementById('statTotal').textContent = total;
      document.getElementById('statToday').textContent = todayCount;
      document.getElementById('statWeek').textContent = weekCount;
      document.getElementById('statFolders').textContent = folders;
      document.getElementById('itemCount').textContent = `${total} item${total !== 1 ? 's' : ''}`;
    }
    
    function renderPlatforms() {
      const platforms = ['All', 'YouTube', 'Article', 'Podcast', 'Tweet', 'Custom'];
      const counts = {};
      platforms.forEach(p => counts[p] = 0);
      state.bookmarks.forEach(b => {
        const p = b.platform || 'Article';
        if (counts[p] !== undefined) counts[p]++;
      });
      counts['All'] = state.bookmarks.length;
      
      const html = platforms.map(p => 
        `<button class="pill ${state.filter.platform === p ? 'active' : ''}" onclick="setFilter('platform', '${p}')">${p} (${counts[p]})</button>`
      ).join('');
      document.getElementById('platformFilters').innerHTML = html;
    }
    
    function renderFolders() {
      const folderSet = new Set(['All']);
      state.bookmarks.forEach(b => folderSet.add(b.folder || 'General'));
      const folders = Array.from(folderSet);
      
      const counts = {};
      folders.forEach(f => counts[f] = 0);
      state.bookmarks.forEach(b => counts[b.folder || 'General']++);
      counts['All'] = state.bookmarks.length;
      
      const html = folders.map(f =>
        `<button class="pill ${state.filter.folder === f ? 'active' : ''}" onclick="setFilter('folder', '${esc(f)}')">${esc(f)} (${counts[f]})</button>`
      ).join('');
      document.getElementById('folderFilters').innerHTML = html;
    }
    
    function setFilter(type, value) {
      state.filter[type] = value;
      state.page = 1;
      render();
    }
    
    function renderContent() {
      if (state.tab === 'bookmarks') renderBookmarks();
      else if (state.tab === 'snippets') renderSnippets();
      else if (state.tab === 'images') renderImages();
    }
    
    function getFiltered() {
      return state.bookmarks.filter(b => {
        if (state.filter.platform !== 'All' && b.platform !== state.filter.platform) return false;
        if (state.filter.folder !== 'All' && (b.folder || 'General') !== state.filter.folder) return false;
        if (state.filter.search) {
          const q = state.filter.search.toLowerCase();
          const searchable = [b.title, b.url, b.notes, b.snippetTitle, b.snippetContent, b.imageTitle, ...(b.tags || [])].join(' ').toLowerCase();
          if (!searchable.includes(q)) return false;
        }
        return true;
      });
    }
    
    function renderBookmarks() {
      const filtered = getFiltered().filter(b => b.url);
      const totalFiltered = filtered.length;
      const paginated = filtered.slice(0, state.page * PAGE_SIZE);
      const hasMore = totalFiltered > paginated.length;
      const remaining = totalFiltered - paginated.length;
      
      if (paginated.length === 0) {
        document.getElementById('bookmarksPanel').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg></div>
            <div class="empty-title">No bookmarks yet</div>
            <div class="empty-text">Tap + to add your first bookmark</div>
          </div>`;
        return;
      }
      
      const selectableClass = state.selectMode ? 'selectable' : '';
      
      const html = paginated.map((b, i) => {
        const idx = state.bookmarks.indexOf(b) + 1;
        const thumb = b.thumbnail || (b.url ? getFavicon(b.url) : '');
        const domain = b.url ? getDomain(b.url) : '';
        const tags = (b.tags || []).map(t => `<span class="tag">${esc(t)}</span>`).join('');
        const isSelected = state.selectedIds.has(b.id);
        
        return `
          <div class="bookmark-card ${selectableClass} ${isSelected ? 'selected' : ''}" onclick="${state.selectMode ? `toggleSelect('${b.id}')` : ''}">
            <div class="select-checkbox">
              ${isSelected ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>' : ''}
            </div>
            <div class="bookmark-header">
              <img class="bookmark-thumb" src="${esc(thumb)}" alt="" loading="lazy" onerror="this.style.display='none'">
              <div class="bookmark-info">
                <div class="bookmark-meta">
                  <span class="meta-badge">#${idx}</span>
                  <span class="meta-badge">${esc(b.platform || 'Article')}</span>
                  <span class="meta-badge">${esc(b.folder || 'General')}</span>
                </div>
                <a href="${esc(b.url)}" target="_blank" rel="noopener" class="bookmark-title" onclick="event.stopPropagation()">${esc(b.title || 'Untitled')}</a>
                <div class="bookmark-url">${esc(domain)}</div>
              </div>
            </div>
            ${tags ? `<div class="bookmark-tags">${tags}</div>` : ''}
            ${b.notes ? `<div class="bookmark-notes">${esc(b.notes)}</div>` : ''}
            ${!state.selectMode ? `
            <div class="bookmark-actions">
              <a href="${esc(b.url)}" target="_blank" rel="noopener" class="action-btn" onclick="event.stopPropagation()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                Open
              </a>
              <button class="action-btn" onclick="event.stopPropagation(); showActionSheet('${b.id}')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                More
              </button>
            </div>
            ` : ''}
          </div>`;
      }).join('');
      
      const loadMoreText = hasMore ? `Load More (${remaining} remaining, #${paginated.length + 1} - #${totalFiltered})` : '';
      
      document.getElementById('bookmarksPanel').innerHTML = html + 
        `<button class="load-more ${hasMore ? 'show' : ''}">${loadMoreText}</button>`;
    }
    
    function renderSnippets() {
      const snippets = getFiltered().filter(b => b.snippetContent);
      const selectableClass = state.selectMode ? 'selectable' : '';
      
      if (snippets.length === 0) {
        document.getElementById('snippetsPanel').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg></div>
            <div class="empty-title">No snippets yet</div>
            <div class="empty-text">Add text snippets to save them here</div>
          </div>`;
        return;
      }
      
      const html = snippets.map(b => {
        const isSelected = state.selectedIds.has(b.id);
        return `
        <div class="snippet-card ${selectableClass} ${isSelected ? 'selected' : ''}" onclick="${state.selectMode ? `toggleSelect('${b.id}')` : `showActionSheet('${b.id}')`}">
          <div class="select-checkbox">
            ${isSelected ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>' : ''}
          </div>
          <div class="snippet-header">
            <div class="snippet-title">${esc(b.snippetTitle || 'Untitled Snippet')}</div>
            <div class="snippet-folder">${esc(b.folder || 'General')}</div>
          </div>
          <div class="snippet-content">${esc(b.snippetContent)}</div>
        </div>`;
      }).join('');
      
      document.getElementById('snippetsPanel').innerHTML = html;
    }
    
    function renderImages() {
      const images = getFiltered().filter(b => b.imageData || b.imageUrl);
      const selectableClass = state.selectMode ? 'selectable' : '';
      
      if (images.length === 0) {
        document.getElementById('imagesPanel').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></div>
            <div class="empty-title">No images yet</div>
            <div class="empty-text">Upload or add image URLs</div>
          </div>`;
        return;
      }
      
      const html = `<div class="image-grid">${images.map(b => {
        const isSelected = state.selectedIds.has(b.id);
        return `
        <div class="image-card ${selectableClass} ${isSelected ? 'selected' : ''}" onclick="${state.selectMode ? `toggleSelect('${b.id}')` : `showActionSheet('${b.id}')`}">
          <div class="select-checkbox">
            ${isSelected ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>' : ''}
          </div>
          <img src="${esc(b.imageData || b.imageUrl)}" alt="${esc(b.imageTitle || 'Image')}" loading="lazy">
          <div class="image-card-title">${esc(b.imageTitle || 'Untitled')}</div>
        </div>`;
      }).join('')}</div>`;
      
      document.getElementById('imagesPanel').innerHTML = html;
    }
    
    function updateFolderDatalist() {
      const folders = new Set();
      state.bookmarks.forEach(b => folders.add(b.folder || 'General'));
      document.getElementById('folderList').innerHTML = 
        Array.from(folders).map(f => `<option value="${esc(f)}">`).join('');
    }
    
    // Modal functions
    function openAddModal() {
      state.editId = null;
      state.imageData = '';
      document.getElementById('modalTitle').textContent = 'Add Bookmark';
      document.getElementById('formUrl').value = '';
      document.getElementById('formTitle').value = '';
      document.getElementById('formPlatform').value = 'Article';
      document.getElementById('formFolder').value = '';
      document.getElementById('formTags').value = '';
      document.getElementById('formNotes').value = '';
      document.getElementById('formSnippetTitle').value = '';
      document.getElementById('formSnippetContent').value = '';
      document.getElementById('formImageTitle').value = '';
      document.getElementById('formImageUrl').value = '';
      document.getElementById('imagePreview').classList.add('hidden');
      openModal(document.getElementById('addModal'));
    }
    
    function editBookmark(id) {
      const b = state.bookmarks.find(x => x.id === id);
      if (!b) return;
      
      state.editId = id;
      state.imageData = b.imageData || '';
      document.getElementById('modalTitle').textContent = 'Edit Bookmark';
      document.getElementById('formUrl').value = b.url || '';
      document.getElementById('formTitle').value = b.title || '';
      document.getElementById('formPlatform').value = b.platform || 'Article';
      document.getElementById('formFolder').value = b.folder || '';
      document.getElementById('formTags').value = (b.tags || []).join(', ');
      document.getElementById('formNotes').value = b.notes || '';
      document.getElementById('formSnippetTitle').value = b.snippetTitle || '';
      document.getElementById('formSnippetContent').value = b.snippetContent || '';
      document.getElementById('formImageTitle').value = b.imageTitle || '';
      document.getElementById('formImageUrl').value = b.imageUrl || '';
      
      if (b.imageData) {
        document.getElementById('previewImg').src = b.imageData;
        document.getElementById('imagePreview').classList.remove('hidden');
      } else {
        document.getElementById('imagePreview').classList.add('hidden');
      }
      
      openModal(document.getElementById('addModal'));
    }
    
    function closeAddModal() {
      closeModal(document.getElementById('addModal'));
      state.editId = null;
      state.imageData = '';
    }
    
    function saveBookmark() {
      const url = document.getElementById('formUrl').value.trim();
      const title = document.getElementById('formTitle').value.trim();
      const snippetContent = document.getElementById('formSnippetContent').value.trim();
      const imageUrl = document.getElementById('formImageUrl').value.trim();
      
      if (!url && !snippetContent && !state.imageData && !imageUrl) {
        toast('Please add URL, snippet, or image');
        return;
      }
      
      const bookmark = {
        id: state.editId || uid(),
        url,
        title: title || (url ? getDomain(url) : 'Untitled'),
        platform: url ? detectPlatform(url) : document.getElementById('formPlatform').value,
        folder: document.getElementById('formFolder').value.trim() || 'General',
        tags: document.getElementById('formTags').value.split(',').map(t => t.trim()).filter(Boolean),
        notes: document.getElementById('formNotes').value.trim(),
        snippetTitle: document.getElementById('formSnippetTitle').value.trim(),
        snippetContent,
        imageTitle: document.getElementById('formImageTitle').value.trim(),
        imageUrl,
        imageData: state.imageData,
        thumbnail: '',
        createdAt: state.editId ? state.bookmarks.find(b => b.id === state.editId)?.createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      // Keep existing thumbnail if editing
      if (state.editId) {
        const existing = state.bookmarks.find(b => b.id === state.editId);
        if (existing) bookmark.thumbnail = existing.thumbnail;
      }
      
      // Set thumbnail for YouTube
      if (url && (url.includes('youtube.com') || url.includes('youtu.be'))) {
        const vid = extractYouTubeId(url);
        if (vid) bookmark.thumbnail = `https://img.youtube.com/vi/${vid}/hqdefault.jpg`;
      }
      
      if (state.editId) {
        const idx = state.bookmarks.findIndex(b => b.id === state.editId);
        if (idx >= 0) state.bookmarks[idx] = bookmark;
      } else {
        state.bookmarks.unshift(bookmark);
      }
      
      saveData();
      closeAddModal();
      render();
      toast(state.editId ? 'Bookmark updated' : 'Bookmark saved');
    }
    
    function openModal(el) {
      el.classList.add('open');
      document.body.classList.add('locked');
    }
    
    function closeModal(el) {
      el.classList.remove('open');
      document.body.classList.remove('locked');
    }
    
    // Sheet functions
    function openSheet(sheetId) {
      document.getElementById(sheetId).classList.add('open');
      document.body.classList.add('locked');
    }
    
    function closeAllSheets() {
      document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open'));
      document.body.classList.remove('locked');
    }
    
    function showActionSheet(id) {
      const b = state.bookmarks.find(x => x.id === id);
      if (!b) return;
      state.selectedId = id;
      document.getElementById('actionTitle').textContent = b.title || b.snippetTitle || b.imageTitle || 'Actions';
      openSheet('actionSheet');
    }
    
    function showFolderSheet() {
      const folders = {};
      state.bookmarks.forEach(b => {
        const f = b.folder || 'General';
        folders[f] = (folders[f] || 0) + 1;
      });
      
      let html = `<div class="folder-item ${state.filter.folder === 'All' ? 'active' : ''}" onclick="selectFolder('All')">
        <span>All</span><span class="folder-count">${state.bookmarks.length}</span>
      </div>`;
      
      Object.keys(folders).sort().forEach(f => {
        html += `<div class="folder-item ${state.filter.folder === f ? 'active' : ''}" onclick="selectFolder('${esc(f)}')">
          <span>${esc(f)}</span><span class="folder-count">${folders[f]}</span>
        </div>`;
      });
      
      document.getElementById('folderList2').innerHTML = html;
      openSheet('folderSheet');
    }
    
    function selectFolder(folder) {
      state.filter.folder = folder;
      state.page = 1;
      closeAllSheets();
      render();
    }
    
    // Action handlers
    function editSelected() {
      closeAllSheets();
      editBookmark(state.selectedId);
    }
    
    function copySelected() {
      const b = state.bookmarks.find(x => x.id === state.selectedId);
      if (b && b.url) {
        copyText(b.url);
        toast('Link copied');
      } else if (b && b.snippetContent) {
        copyText(b.snippetContent);
        toast('Snippet copied');
      }
      closeAllSheets();
    }
    
    function shareSelected() {
      const b = state.bookmarks.find(x => x.id === state.selectedId);
      if (!b) return;
      closeAllSheets();
      
      if (navigator.share && b.url) {
        navigator.share({ title: b.title, url: b.url }).catch(() => {});
      } else {
        copySelected();
      }
    }
    
    function deleteSelected() {
      state.bookmarks = state.bookmarks.filter(b => b.id !== state.selectedId);
      saveData();
      closeAllSheets();
      render();
      toast('Deleted');
    }
    
    // Metadata fetching
    async function fetchMetadata() {
      const url = document.getElementById('formUrl').value.trim();
      const titleInput = document.getElementById('formTitle');
      if (!url || titleInput.value) return;
      
      try {
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
          await fetchYouTubeData(url);
        } else {
          const res = await fetch(`https://noembed.com/embed?url=${encodeURIComponent(url)}`);
          const data = await res.json();
          if (data.title) titleInput.value = data.title;
        }
      } catch (e) {
        console.log('Metadata fetch failed:', e);
      }
    }
    
    async function fetchYouTubeData(url) {
      const vid = extractYouTubeId(url);
      if (!vid) return;
      
      try {
        const res = await fetch(`https://noembed.com/embed?url=https://youtube.com/watch?v=${vid}`);
        const data = await res.json();
        if (data.title) document.getElementById('formTitle').value = data.title;
      } catch (e) {
        console.log('YouTube fetch failed:', e);
      }
    }
    
    function extractYouTubeId(url) {
      const patterns = [
        /youtube\.com\/watch\?v=([^&]+)/,
        /youtu\.be\/([^?]+)/,
        /youtube\.com\/embed\/([^?]+)/,
        /youtube\.com\/shorts\/([^?]+)/
      ];
      for (const p of patterns) {
        const m = url.match(p);
        if (m) return m[1];
      }
      return null;
    }
    
    // Clipboard functions
    async function readClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        if (text) {
          state.clipboardContent = text;
          document.getElementById('clipPreview').textContent = text.substring(0, 500);
          openSheet('clipSheet');
        } else {
          toast('Clipboard is empty');
        }
      } catch (e) {
        showPastePrompt();
      }
    }
    
    function showPastePrompt() {
      const prompt = document.getElementById('pastePrompt');
      const area = document.getElementById('pasteArea');
      area.value = '';
      prompt.classList.add('open');
      area.focus();
      
      const timeout = setTimeout(() => closePastePrompt(), 10000);
      
      area.oninput = () => {
        if (area.value) {
          clearTimeout(timeout);
          state.clipboardContent = area.value;
          closePastePrompt();
          document.getElementById('clipPreview').textContent = area.value.substring(0, 500);
          openSheet('clipSheet');
        }
      };
    }
    
    function closePastePrompt() {
      document.getElementById('pastePrompt').classList.remove('open');
    }
    
    function handleClipAction(action) {
      closeAllSheets();
      openAddModal();
      
      const content = state.clipboardContent;
      if (action === 'bookmark') {
        if (isUrl(content)) {
          document.getElementById('formUrl').value = content;
          fetchMetadata();
        } else {
          document.getElementById('formNotes').value = content;
        }
      } else if (action === 'snippet') {
        document.getElementById('formSnippetContent').value = content;
        document.getElementById('formSnippetTitle').value = content.substring(0, 50);
      } else if (action === 'image') {
        document.getElementById('formImageUrl').value = content;
      }
      
      toast('Content added to form');
    }
    
    // Image upload
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        toast('Please select an image file');
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) {
        toast('Image must be under 5MB');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (ev) => {
        state.imageData = ev.target.result;
        document.getElementById('previewImg').src = state.imageData;
        document.getElementById('imagePreview').classList.remove('hidden');
      };
      reader.readAsDataURL(file);
    }
    
    function removeImage() {
      state.imageData = '';
      document.getElementById('imagePreview').classList.add('hidden');
      document.getElementById('imageInput').value = '';
    }
    
    // Theme functions
    function applyTheme() {
      // Remove all theme classes
      THEMES.forEach(t => document.body.classList.remove(t));
      
      // Add current theme class (except light which is default)
      if (state.theme !== 'light') {
        document.body.classList.add(state.theme);
      }
      
      document.getElementById('themeLabel').textContent = THEME_LABELS[state.theme] || 'Light';
      
      // Update theme color meta tag
      const themeColors = {
        'light': '#f59e0b',
        'dark': '#0f172a',
        'neon-pink': '#ff6ec7',
        'neon-cyan': '#00ffff',
        'neon-green': '#39ff14',
        'glass': '#667eea',
        'glass-dark': '#302b63',
        'sunset': '#ff6b6b',
        'ocean': '#0077b6'
      };
      document.querySelector('meta[name="theme-color"]').content = themeColors[state.theme] || '#f59e0b';
      
      // Update theme option active states
      document.querySelectorAll('.theme-option').forEach(opt => {
        const themeName = opt.getAttribute('onclick')?.match(/setTheme\('(.+)'\)/)?.[1];
        opt.classList.toggle('active', themeName === state.theme);
      });
    }
    
    function setTheme(theme) {
      state.theme = theme;
      saveData();
      applyTheme();
      closeAllSheets();
      toast(`${THEME_LABELS[theme]} theme applied`);
    }
    
    // Data management
    function exportData() {
      const data = {
        bookmarks: state.bookmarks,
        exportedAt: new Date().toISOString(),
        version: '2.2'
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `bookmarks-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      toast('Data exported');
    }
    
    function importData(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          const bookmarks = data.bookmarks || data;
          if (!Array.isArray(bookmarks)) throw new Error('Invalid format');
          
          const merge = confirm('Merge with existing data?\n\nOK = Merge\nCancel = Replace');
          
          if (merge) {
            const existingIds = new Set(state.bookmarks.map(b => b.id));
            bookmarks.forEach(b => {
              if (!b.id) b.id = uid();
              if (!existingIds.has(b.id)) state.bookmarks.push(b);
            });
          } else {
            state.bookmarks = bookmarks.map(b => ({ ...b, id: b.id || uid() }));
          }
          
          saveData();
          render();
          toast(`Imported ${bookmarks.length} items`);
        } catch (err) {
          toast('Invalid file format');
        }
      };
      reader.readAsText(file);
      e.target.value = '';
    }
    
    function clearAllData() {
      if (!confirm('Clear ALL bookmarks? This cannot be undone!')) return;
      
      state.bookmarks = [];
      saveData();
      render();
      toast('All data cleared');
    }
    
    // GitHub sync
    async function pullGitHub() {
      const { owner, repo, path } = state.github;
      if (!owner || !repo || !path) {
        toast('Please fill in GitHub details');
        return;
      }
      
      document.getElementById('ghStatus').textContent = 'Pulling...';
      
      try {
        const headers = {};
        if (state.github.token) headers['Authorization'] = `Bearer ${state.github.token}`;
        
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, { headers });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        
        const data = await res.json();
        const content = atob(data.content);
        const parsed = JSON.parse(content);
        
        state.bookmarks = parsed.bookmarks || parsed;
        state.github.sha = data.sha;
        saveData();
        render();
        
        document.getElementById('ghStatus').textContent = `âœ“ Pulled ${state.bookmarks.length} items`;
        toast('Pull successful');
      } catch (e) {
        document.getElementById('ghStatus').textContent = `âœ— Error: ${e.message}`;
        toast('Pull failed');
      }
    }
    
    async function pushGitHub() {
      const { owner, repo, path, token } = state.github;
      if (!owner || !repo || !path || !token) {
        toast('Please fill in all GitHub details including token');
        return;
      }
      
      document.getElementById('ghStatus').textContent = 'Pushing...';
      
      try {
        const content = btoa(unescape(encodeURIComponent(JSON.stringify({
          bookmarks: state.bookmarks,
          updatedAt: new Date().toISOString()
        }, null, 2))));
        
        const body = {
          message: `Update bookmarks - ${new Date().toLocaleString()}`,
          content
        };
        if (state.github.sha) body.sha = state.github.sha;
        
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });
        
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        
        const data = await res.json();
        state.github.sha = data.content.sha;
        saveData();
        
        document.getElementById('ghStatus').textContent = 'âœ“ Push successful';
        toast('Push successful');
      } catch (e) {
        document.getElementById('ghStatus').textContent = `âœ— Error: ${e.message}`;
        toast('Push failed');
      }
    }
    
    // PWA functions
    function setupPWA() {
      // Create service worker
      const swCode = `
        self.addEventListener('install', e => self.skipWaiting());
        self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
        self.addEventListener('fetch', e => {});
      `;
      const swBlob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(swBlob);
      
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register(swUrl).catch(e => console.log('SW registration failed:', e));
      }
      
      // Create manifest
      const manifest = {
        name: "Mani's Bookmark Vault",
        short_name: "Bookmarks",
        description: "Mobile-first bookmark manager",
        start_url: location.href.split('?')[0],
        display: "standalone",
        orientation: "portrait",
        background_color: "#ffffff",
        theme_color: "#f59e0b",
        icons: [{
          src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23f59e0b'/><path d='M30 20h40v65l-20-15-20 15z' fill='white'/></svg>",
          sizes: "any",
          type: "image/svg+xml",
          purpose: "any maskable"
        }],
        share_target: {
          action: location.href.split('?')[0],
          method: "GET",
          params: { title: "title", text: "text", url: "url" }
        }
      };
      
      const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
      const manifestUrl = URL.createObjectURL(manifestBlob);
      
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = manifestUrl;
      document.head.appendChild(link);
    }
    
    function checkShareTarget() {
      const params = new URLSearchParams(location.search);
      const url = params.get('url') || params.get('text') || '';
      const title = params.get('title') || '';
      
      if (url || title) {
        // Clean URL
        history.replaceState(null, '', location.pathname);
        
        setTimeout(() => {
          openAddModal();
          if (isUrl(url)) {
            document.getElementById('formUrl').value = url;
          } else if (url) {
            document.getElementById('formNotes').value = url;
          }
          if (title) document.getElementById('formTitle').value = title;
          toast('Shared content received');
        }, 100);
      }
    }
    
    function installPWA() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(result => {
          if (result.outcome === 'accepted') {
            toast('App installed!');
          }
          deferredPrompt = null;
        });
      } else {
        toast('Add to Home Screen from browser menu');
      }
    }
    
    // Utility functions
    function uid() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }
    
    function esc(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
    
    function isUrl(str) {
      return str && (str.startsWith('http://') || str.startsWith('https://'));
    }
    
    function getDomain(url) {
      try {
        return new URL(url).hostname.replace('www.', '');
      } catch {
        return url;
      }
    }
    
    function getFavicon(url) {
      try {
        const domain = new URL(url).hostname;
        return `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
      } catch {
        return '';
      }
    }
    
    function detectPlatform(url) {
      if (!url) return 'Custom';
      const u = url.toLowerCase();
      if (u.includes('youtube.com') || u.includes('youtu.be')) return 'YouTube';
      if (u.includes('twitter.com') || u.includes('x.com')) return 'Tweet';
      if (u.includes('spotify.com') || u.includes('podcast') || u.includes('anchor.fm')) return 'Podcast';
      if (u.includes('medium.com') || u.includes('dev.to') || u.includes('blog')) return 'Article';
      return 'Article';
    }
    
    function copyText(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }
    }
    
    function fallbackCopy(text) {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
    }
    
    function toast(message, duration = 2500) {
      const t = document.getElementById('toast');
      t.textContent = message;
      t.classList.add('show');
      if (navigator.vibrate) navigator.vibrate(10);
      setTimeout(() => t.classList.remove('show'), duration);
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
